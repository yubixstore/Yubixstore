<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>YUBIX STORE</title>
<style>
  :root{--blue:#0d47a1;--black:#0a0a0a;--bg:#f4f6fb;--card:#fff;--muted:#64748b;--accent:#0d47a1}
  *{box-sizing:border-box} body{margin:0;font-family:"Tajawal",system-ui,Arial;background:var(--bg);color:#0b1220}
  /* Welcome */
  #welcome{min-height:100vh;display:grid;place-items:center;background:linear-gradient(135deg,var(--black),var(--blue));color:#fff;text-align:center;padding:24px}
  .wel{max-width:560px}
  .logo{width:100px;height:100px;border-radius:24px;background:#fff;display:inline-grid;place-items:center;color:var(--blue);font-weight:800;font-size:28px;margin-bottom:12px}
  .btn{border:0;border-radius:12px;padding:14px 22px;cursor:pointer;font-weight:800}
  .btn-primary{background:#fff;color:var(--blue)}
  .btn-primary:hover{opacity:.92}
  /* Store */
  #store{display:none;padding:18px;max-width:1000px;margin:0 auto}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
  .brand{display:flex;gap:10px;align-items:center}
  .brand .mini-logo{width:36px;height:36px;border-radius:10px;background:var(--blue);color:#fff;display:grid;place-items:center;font-weight:900}
  .card{background:var(--card);border:1px solid #e7eef6;border-radius:16px;box-shadow:0 8px 24px rgba(2,6,23,.05)}
  .grid{display:grid;grid-template-columns:2fr 1fr;gap:16px}
  @media(max-width:900px){.grid{grid-template-columns:1fr}}
  .products{display:grid;gap:10px}
  .product{display:flex;gap:12px;align-items:center;padding:12px;border-radius:14px;border:1px solid #eef2f7}
  .product .click{display:flex;gap:12px;align-items:center;flex:1;min-width:0;cursor:pointer}
  .pimg{width:66px;height:66px;border-radius:14px;background:#eef2f7;overflow:hidden;display:grid;place-items:center}
  .pimg img{width:100%;height:100%;object-fit:cover}
  .title{margin:0;font-weight:800}
  .muted{color:var(--muted);font-size:13px}
  .colors{display:flex;gap:6px;margin-top:6px}
  .dot{width:24px;height:24px;border-radius:999px;border:2px solid #fff;box-shadow:0 1px 2px rgba(0,0,0,.12);cursor:pointer}
  .dot.sel{outline:3px solid rgba(13,71,161,.25)}
  .qty{display:inline-flex;align-items:center;border:1px solid #dbe4f0;border-radius:999px;overflow:hidden}
  .qty button{width:34px;height:34px;border:0;background:#fff;cursor:pointer;font-size:18px}
  .qty input{width:56px;text-align:center;border:0;outline:none;height:34px}
  aside .card{padding:14px}
  .row{display:flex;justify-content:space-between;align-items:center;margin:6px 0}
  .btn-full{width:100%;background:var(--accent);color:#fff}
  .sep{border:none;border-top:1px solid #eef2f6;margin:10px 0}
  footer{text-align:center;color:#5b6b82;margin:22px 0}
  footer .socials{display:flex;gap:10px;justify-content:center;margin-top:6px}
  footer .socials a{padding:8px 10px;border:1px solid #e6edf6;background:#fff;border-radius:10px;text-decoration:none;color:#0b1220}

  /* ====== Modal (ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬) ====== */
  #detailOverlay{position:fixed;inset:0;background:rgba(2,6,23,.55);display:none;align-items:center;justify-content:center;padding:16px;z-index:40}
  .detail-card{background:#fff;border-radius:18px;max-width:640px;width:100%;display:grid;grid-template-columns:180px 1fr;gap:16px;padding:16px;border:1px solid #e7eef6;box-shadow:0 20px 60px rgba(0,0,0,.2)}
  @media(max-width:640px){.detail-card{grid-template-columns:1fr}}
  .detail-img{width:100%;height:180px;background:#eef2f7;border-radius:14px;overflow:hidden;display:grid;place-items:center}
  .detail-img img{width:100%;height:100%;object-fit:cover}
  .detail-head{display:flex;justify-content:space-between;gap:8px}
  .x{background:#eef2f7;border:0;border-radius:10px;width:36px;height:36px;cursor:pointer}
  .detail-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .btn-ghost{background:#fff;border:1px solid #e7eef6}
</style>
</head>
<body>

<!-- ÙˆØ§Ø¬Ù‡Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ© -->
<section id="welcome">
  <div class="wel">
    <div class="logo">Y</div>
    <h1 style="margin:8px 0 4px 0">YUBIX STORE</h1>
    <div style="opacity:.9;margin-bottom:14px">Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ! Ø§Ø®ØªÙØ± Ù…Ù†ØªØ¬Ø§ØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©ØŒ Ø£Ù„ÙˆØ§Ù† Ù…ØªØ¹Ø¯Ø¯Ø© ÙˆØ¨Ø³Ø¹Ø± Ù…Ù†Ø§Ø³Ø¨.</div>
    <button class="btn btn-primary" onclick="enterStore()">Ø§Ø¯Ø®Ù„ Ù„Ù„Ù…ØªØ¬Ø±</button>
  </div>
</section>

<!-- Ø§Ù„Ù…ØªØ¬Ø± -->
<section id="store">
  <header>
    <div class="brand"><div class="mini-logo">Y</div><div><div style="font-weight:900">YUBIX STORE</div><div class="muted">Ø£Ù„ÙˆØ§Ù†: Ø£Ø²Ø±Ù‚ â€¢ Ø£Ø³ÙˆØ¯ â€¢ Ø£Ø¨ÙŠØ¶</div></div></div>
    <div class="muted">Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</div>
  </header>

  <div class="grid">
    <!-- ÙŠØ³Ø§Ø±: Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    <div class="card" style="padding:12px">
      <h3 style="margin:6px 8px 12px 8px">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
      <div id="products" class="products"></div>
    </div>

    <!-- ÙŠÙ…ÙŠÙ†: Ø§Ù„Ø³Ù„Ø© + Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ† -->
    <aside>
      <div class="card">
        <h3 style="margin:0 0 8px 0">Ø³Ù„ØªÙƒ</h3>
        <div id="cart"></div>
        <div class="row"><div class="muted">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</div><div id="subtotal">0 Ø¯Ø¬</div></div>
        <div class="row"><div class="muted">Ø§Ù„ØªÙˆØµÙŠÙ„</div><div id="delivery">200 Ø¯Ø¬</div></div>
        <div class="row" style="font-weight:900"><div>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div><div id="grand">0 Ø¯Ø¬</div></div>
        <hr class="sep">
        <div class="muted" style="margin-bottom:6px">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†</div>
        <input class="card" id="cust_name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" style="width:100%;padding:10px;margin-bottom:8px">
        <input class="card" id="cust_phone" placeholder="Ø§Ù„Ù‡Ø§ØªÙ" style="width:100%;padding:10px;margin-bottom:8px">
        <textarea class="card" id="cust_addr" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„" style="width:100%;padding:10px;height:80px"></textarea>
        <button class="btn btn-full" style="margin-top:10px" onclick="sendOrder()">ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
      </div>
    </aside>
  </div>

  <footer>
    <div>Ø´ÙƒØ±Ø§ Ø¹Ù„Ù‰ Ø²ÙŠØ§Ø±ØªÙƒÙ… â¤ â€” ØªØ§Ø¨Ø¹ÙˆÙ†Ø§ Ø¹Ù„Ù‰ Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªÙˆØ§ØµÙ„</div>
    <div class="socials">
      <a href="#" target="_blank">ğŸ“¸ Ø¥Ù†Ø³ØªØºØ±Ø§Ù…</a>
      <a href="#" target="_blank">ğŸµ ØªÙŠÙƒ ØªÙˆÙƒ</a>
      <a href="#" target="_blank">ğŸ“˜ ÙØ§ÙŠØ³Ø¨ÙˆÙƒ</a>
      <a href="#" target="_blank">âœˆï¸ ØªÙŠÙ„ÙŠØºØ±Ø§Ù…</a>
    </div>
  </footer>
</section>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ -->
<div id="detailOverlay" onclick="overlayBgClick(event)">
  <div class="detail-card" id="detailCard">
    <div class="detail-img"><img id="d_img" alt=""></div>
    <div>
      <div class="detail-head">
        <div>
          <h3 id="d_name" style="margin:0 0 4px 0"></h3>
          <div id="d_price" class="muted"></div>
        </div>
        <button class="x" onclick="closeDetail()">âœ•</button>
      </div>

      <div style="margin-top:8px">
        <div class="muted" style="margin-bottom:6px">Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ†</div>
        <div id="d_colors" class="colors"></div>
      </div>

      <div style="margin-top:12px;display:flex;align-items:center;gap:8px">
        <div class="muted">Ø§Ù„ÙƒÙ…ÙŠØ©:</div>
        <div class="qty">
          <button onclick="detailQty(-1)">âˆ’</button>
          <input id="d_qty" type="number" min="1" value="1" onchange="detailSetQty(this.value)">
          <button onclick="detailQty(1)">+</button>
        </div>
      </div>

      <div class="detail-actions">
        <button class="btn btn-ghost" onclick="closeDetail()">Ø¥Ù„ØºØ§Ø¡</button>
        <button class="btn btn-primary" onclick="saveDetail()">Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ù„Ø©</button>
      </div>
    </div>
  </div>
</div>

<script>
  // â€”â€”â€”â€”â€” Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø¨Ø¯Ù‘Ù„Ù‡Ù… Ø¨ØµÙˆØ±Ùƒ ÙˆØ£Ø³Ø¹Ø§Ø±Ùƒ) â€”â€”â€”â€”â€”
  const PRODUCTS = [
    { id:'p1', name:'Ø³Ù…Ø§Ø¹Ø§Øª Ø¨Ù„ÙˆØªÙˆØ« P9', price: 2000, img:'https://via.placeholder.com/256?text=P9', colors:['Ø£Ø³ÙˆØ¯','Ø£Ø¨ÙŠØ¶','Ø£Ø²Ø±Ù‚'] },
    { id:'p2', name:'Ø³Ù…Ø§Ø¹Ø© Ø³Ù„ÙƒÙŠØ© Pro',   price: 1500, img:'https://via.placeholder.com/256?text=Wired', colors:['Ø£Ø³ÙˆØ¯','Ø£Ø¨ÙŠØ¶','Ø£Ø²Ø±Ù‚'] },
    { id:'p3', name:'Ø¨Ø§ÙˆØ±Ø¨Ø§Ù†Ùƒ 10000mAh',  price: 3200, img:'https://via.placeholder.com/256?text=Power', colors:['Ø£Ø³ÙˆØ¯','Ø£Ø¨ÙŠØ¶'] }
  ];

  // Ø­Ø§Ù„Ø© Ù…Ø­Ù„ÙŠØ©
  let cart = {}; // {id: {qty,color}}
  let detail = { id:null, color:null, qty:1 }; // Ø­Ø§Ù„Ø© Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„

  const fmt = n => `${Number(n).toLocaleString('ar-DZ')} Ø¯Ø¬`;
  const $  = s => document.querySelector(s);

  function enterStore(){ $('#welcome').style.display='none'; $('#store').style.display='block'; renderProducts(); renderCart(); }

  function renderProducts(){
    const wrap = $('#products'); wrap.innerHTML='';
    PRODUCTS.forEach(p=>{
      const chosen = (cart[p.id]?.color) || p.colors[0];
      const qty    = (cart[p.id]?.qty)||0;
      const el = document.createElement('div');
      el.className='product';
      el.innerHTML = `
        <div class="click" onclick="openDetail('${p.id}')">
          <div class="pimg"><img src="${p.img}" alt="${p.name}"></div>
          <div style="flex:1;min-width:0">
            <h4 class="title">${p.name}</h4>
            <div class="muted">${fmt(p.price)}</div>
          </div>
        </div>
        <div>
          <div class="muted" style="margin-bottom:6px;text-align:center">${chosen}</div>
          <div class="qty">
            <button onclick="chgQty('${p.id}',-1)">âˆ’</button>
            <input id="q-${p.id}" type="number" min="0" value="${qty}" onchange="setQty('${p.id}', this.value)">
            <button onclick="chgQty('${p.id}',1)">+</button>
          </div>
        </div>
      `;
      wrap.appendChild(el);
    });
  }

  function setColor(id,c){ cart[id] = { qty:(cart[id]?.qty||0), color:c }; renderProducts(); renderCart(); }
  function chgQty(id,delta){ setQty(id, Math.max(0,(cart[id]?.qty||0)+delta)); }
  function setQty(id,v){ const qty=Math.max(0,Number(v||0)); const color = cart[id]?.color || PRODUCTS.find(x=>x.id===id).colors[0]; cart[id]={qty,color}; renderCart(); }

  function renderCart(){
    const c = $('#cart'); c.innerHTML='';
    let subtotal = 0;
    Object.entries(cart).forEach(([id,{qty,color}])=>{
      if(qty>0){
        const p = PRODUCTS.find(x=>x.id===id);
        const line = document.createElement('div'); line.className='row';
        const linePrice = p.price*qty; subtotal += linePrice;
        line.innerHTML = `<div>${p.name} ${color?`(${color})`:''} Ã— ${qty}</div><div>${fmt(linePrice)}</div>`;
        c.appendChild(line);
      }
    });
    const delivery = subtotal>0 ? 200 : 0;
    $('#subtotal').textContent = fmt(subtotal);
    $('#delivery').textContent = fmt(delivery);
    $('#grand').textContent    = fmt(subtotal+delivery);
  }

  // ====== Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ ======
  function colorToCss(name){
    if(name.includes('Ø£Ø²Ø±Ù‚')) return '#1e40af';
    if(name.includes('Ø£Ø³ÙˆØ¯')) return '#111';
    if(name.includes('Ø£Ø¨ÙŠØ¶')) return '#fff';
    return '#eee';
  }

  function openDetail(id){
    const p = PRODUCTS.find(x=>x.id===id);
    detail.id = id;
    detail.color = cart[id]?.color || p.colors[0];
    detail.qty   = Math.max(1, cart[id]?.qty || 1);

    $('#d_img').src   = p.img;
    $('#d_name').textContent = p.name;
    $('#d_price').textContent = fmt(p.price);
    $('#d_qty').value = detail.qty;

    const cw = $('#d_colors'); cw.innerHTML='';
    p.colors.forEach(col=>{
      const d = document.createElement('div');
      d.className = 'dot' + (col===detail.color ? ' sel' : '');
      d.style.background = colorToCss(col);
      if(col==='Ø£Ø¨ÙŠØ¶') d.style.border='1px solid #e5eaf1';
      d.title = col;
      d.onclick = ()=>{ detail.color = col; openDetail(id); }; // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ù„ØªØ­Ø¯ÙŠØ« sel
      cw.appendChild(d);
    });

    $('#detailOverlay').style.display='flex';
  }

  function closeDetail(){ $('#detailOverlay').style.display='none'; }
  function overlayBgClick(e){ if(e.target.id==='detailOverlay') closeDetail(); }
  function detailQty(delta){ const v = Math.max(1, Number($('#d_qty').value||1) + delta); $('#d_qty').value=v; detail.qty=v; }
  function detailSetQty(v){ detail.qty = Math.max(1, Number(v||1)); }

  function saveDetail(){
    const id = detail.id;
    if(!id) return;
    cart[id] = { qty: detail.qty, color: detail.color };
    closeDetail();
    renderProducts();
    renderCart();
  }

  // ====== Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø®Ø§Ø¯Ù… â†’ Telegram ======
  async function sendOrder(){
    const name = $('#cust_name').value.trim();
    const phone= $('#cust_phone').value.trim();
    const addr = $('#cust_addr').value.trim();
    if(!name || !phone || !addr){ alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø£ ÙƒÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†.'); return; }

    const items = Object.entries(cart)
      .filter(([_,v])=> (v.qty||0)>0)
      .map(([id,v])=>{
        const p = PRODUCTS.find(x=>x.id===id);
        return { id, name:p.name, price:p.price, qty:v.qty, color:v.color };
      });
    if(items.length===0){ alert('Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©.'); return; }

    const payload = { shop:'YUBIX STORE', customer:{ name, phone, address: addr }, items };

    try{
      const res = await fetch('/api/send-order', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      if(!res.ok) throw new Error('send failed');
      alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ! Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ.');
      cart = {}; renderProducts(); renderCart();
      $('#cust_name').value=''; $('#cust_phone').value=''; $('#cust_addr').value='';
    }catch(e){
      alert('âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„. ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ø´ØºØ§Ù„ ÙˆØ§Ù„Ù…Ø³Ø§Ø± ØµØ­ÙŠØ­.');
    }
  }
</script>
</body>
</html>


